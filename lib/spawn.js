"use strict";
/**
 * Created by user on 2019/5/18.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const crossSpawn = require("cross-spawn-extra");
const index_1 = require("./index");
function requireResolve(name) {
    try {
        let ret = require.resolve(name);
        if (ret) {
            return ret;
        }
    }
    catch (e) {
    }
    return null;
}
exports.requireResolve = requireResolve;
function checkModileExists(argv) {
    let ret = requireResolve(argv.requireName || argv.name);
    if (!ret) {
        index_1.console.magenta.log(`module '${argv.name}' not exists`);
        index_1.console.log(`please use follow cmd for install`);
        index_1.console.cyan.log(`\n\t${argv.installCmd || 'npm install -g'} ${argv.name}\n`);
        if (argv.msg) {
            index_1.console.log(`${argv.msg}\n`);
        }
        if (argv.processExit) {
            process.exit(argv.processExit | 0);
        }
        return null;
    }
    return ret;
}
exports.checkModileExists = checkModileExists;
function _crossSpawnOther(cp) {
    // @ts-ignore
    if (cp.error) {
        // @ts-ignore
        throw cp.error;
    }
    // @ts-ignore
    if (cp.signal) {
        // @ts-ignore
        index_1.consoleDebug.error(`cp.signal`, cp.signal);
        process.exit(1);
    }
    return cp;
}
exports._crossSpawnOther = _crossSpawnOther;
function crossSpawnOther(bin, cmd_list, argv) {
    index_1.consoleDebug.debug(bin, cmd_list);
    let cp = crossSpawn.sync('npm', cmd_list.filter(v => v != null), {
        stdio: 'inherit',
        cwd: argv.cwd,
    });
    return _crossSpawnOther(cp);
}
exports.crossSpawnOther = crossSpawnOther;
function crossSpawnOtherAsync(bin, cmd_list, argv) {
    index_1.consoleDebug.debug(bin, cmd_list);
    return crossSpawn.async('npm', cmd_list.filter(v => v != null), {
        stdio: 'inherit',
        cwd: argv.cwd,
    })
        .tap(_crossSpawnOther);
}
exports.crossSpawnOtherAsync = crossSpawnOtherAsync;
function processArgvSlice(keys_input, argv_input = process.argv, startindex = 2) {
    if (typeof keys_input === 'string') {
        keys_input = [keys_input];
    }
    let argv_before = argv_input.slice(0, startindex);
    let argv_after = argv_input.slice(startindex);
    let idx = keys_input.reduce(function (a, b) {
        let i = argv_after.indexOf(b);
        if (a === -1) {
            return i;
        }
        else if (i !== -1) {
            return Math.min(i, a);
        }
        return a;
    }, -1);
    let argv = (idx > -1) ? argv_after.slice(idx + 1) : null;
    let key = (idx > -1) ? argv_after[idx] : null;
    let idx_rebase = (idx > -1) ? idx + startindex : -1;
    return {
        idx_rebase,
        idx,
        argv_input,
        argv_before,
        argv_after,
        argv,
        keys_input,
        key,
    };
}
exports.processArgvSlice = processArgvSlice;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3Bhd24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzcGF3bi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBRUgsZ0RBQWlEO0FBR2pELG1DQUFnRDtBQUdoRCxTQUFnQixjQUFjLENBQUMsSUFBWTtJQUUxQyxJQUNBO1FBQ0MsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVoQyxJQUFJLEdBQUcsRUFDUDtZQUNDLE9BQU8sR0FBRyxDQUFBO1NBQ1Y7S0FDRDtJQUNELE9BQU8sQ0FBQyxFQUNSO0tBRUM7SUFFRCxPQUFPLElBQUksQ0FBQztBQUNiLENBQUM7QUFqQkQsd0NBaUJDO0FBRUQsU0FBZ0IsaUJBQWlCLENBQUMsSUFNakM7SUFFQSxJQUFJLEdBQUcsR0FBRyxjQUFjLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFeEQsSUFBSSxDQUFDLEdBQUcsRUFDUjtRQUNDLGVBQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsSUFBSSxDQUFDLElBQUksY0FBYyxDQUFDLENBQUM7UUFDeEQsZUFBTyxDQUFDLEdBQUcsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO1FBQ2pELGVBQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sSUFBSSxDQUFDLFVBQVUsSUFBSSxnQkFBZ0IsSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQztRQUU5RSxJQUFJLElBQUksQ0FBQyxHQUFHLEVBQ1o7WUFDQyxlQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7U0FDN0I7UUFFRCxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQ3BCO1lBQ0MsT0FBTyxDQUFDLElBQUksQ0FBRSxJQUFJLENBQUMsV0FBc0IsR0FBRyxDQUFDLENBQUMsQ0FBQztTQUMvQztRQUVELE9BQU8sSUFBSSxD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Q0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsVUFBVSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFFOUMsSUFBSSxVQUFVLEdBQUcsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsR0FBRyxHQUFHLFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFFcEQsT0FBTztRQUNOLFVBQVU7UUFDVixHQUFHO1FBQ0gsVUFBVTtRQUNWLFdBQVc7UUFDWCxVQUFVO1FBQ1YsSUFBSTtRQUNKLFVBQVU7UUFDVixHQUFHO0tBQ0gsQ0FBQztBQUNILENBQUM7QUExQ0QsNENBMENDIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDcmVhdGVkIGJ5IHVzZXIgb24gMjAxOS81LzE4LlxuICovXG5cbmltcG9ydCBjcm9zc1NwYXduID0gcmVxdWlyZSgnY3Jvc3Mtc3Bhd24tZXh0cmEnKTtcbmltcG9ydCAqIGFzIHlhcmdzIGZyb20gJ3lhcmdzJztcbmltcG9ydCB7IElVbnBhY2tNeVlhcmdzQXJndiB9IGZyb20gJy4vY2xpJztcbmltcG9ydCB7IGNvbnNvbGVEZWJ1ZywgY29uc29sZSB9IGZyb20gJy4vaW5kZXgnO1xuaW1wb3J0IEJsdWViaXJkID0gcmVxdWlyZSgnYmx1ZWJpcmQnKTtcblxuZXhwb3J0IGZ1bmN0aW9uIHJlcXVpcmVSZXNvbHZlKG5hbWU6IHN0cmluZylcbntcblx0dHJ5XG5cdHtcblx0XHRsZXQgcmV0ID0gcmVxdWlyZS5yZXNvbHZlKG5hbWUpO1xuXG5cdFx0aWYgKHJldClcblx0XHR7XG5cdFx0XHRyZXR1cm4gcmV0XG5cdFx0fVxuXHR9XG5cdGNhdGNoIChlKVxuXHR7XG5cblx0fVxuXG5cdHJldHVybiBudWxsO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY2hlY2tNb2RpbGVFeGlzdHMoYXJndjoge1xuXHRuYW1lOiBzdHJpbmcsXG5cdG1zZz86IHN0cmluZyxcblx0cmVxdWlyZU5hbWU/OiBzdHJpbmcsXG5cdGluc3RhbGxDbWQ/OiBzdHJpbmdcblx0cHJvY2Vzc0V4aXQ/OiBib29sZWFuIHwgbnVtYmVyLFxufSlcbntcblx0bGV0IHJldCA9IHJlcXVpcmVSZXNvbHZlKGFyZ3YucmVxdWlyZU5hbWUgfHwgYXJndi5uYW1lKTtcblxuXHRpZiAoIXJldClcblx0e1xuXHRcdGNvbnNvbGUubWFnZW50YS5sb2coYG1vZHVsZSAnJHthcmd2Lm5hbWV9JyBub3QgZXhpc3RzYCk7XG5cdFx0Y29uc29sZS5sb2coYHBsZWFzZSB1c2UgZm9sbG93IGNtZCBmb3IgaW5zdGFsbGApO1xuXHRcdGNvbnNvbGUuY3lhbi5sb2coYFxcblxcdCR7YXJndi5pbnN0YWxsQ21kIHx8ICducG0gaW5zdGFsbCAtZyd9ICR7YXJndi5uYW1lfVxcbmApO1xuXG5cdFx0aWYgKGFyZ3YubXNnKVxuXHRcdHtcblx0XHRcdGNvbnNvbGUubG9nKGAke2FyZ3YubXNnfVxcbmApO1xuXHRcdH1cblxuXHRcdGlmIChhcmd2LnByb2Nlc3NFeGl0KVxuXHRcdHtcblx0XHRcdHByb2Nlc3MuZXhpdCgoYXJndi5wcm9jZXNzRXhpdCBhcyBudW1iZXIpIHwgMCk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIG51bGw7XG5cdH1cblxuXHRyZXR1cm4gcmV0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gX2Nyb3NzU3Bhd25PdGhlcjxUPihjcDogVClcbntcblx0Ly8gQHRzLWlnbm9yZVxuXHRpZiAoY3AuZXJyb3IpXG5cdHtcblx0XHQvLyBAdHMtaWdub3JlXG5cdFx0dGhyb3cgY3AuZXJyb3Jcblx0fVxuXG5cdC8vIEB0cy1pZ25vcmVcblx0aWYgKGNwLnNpZ25hbClcblx0e1xuXHRcdC8vIEB0cy1pZ25vcmVcblx0XHRjb25zb2xlRGVidWcuZXJyb3IoYGNwLnNpZ25hbGAsIGNwLnNpZ25hbCk7XG5cdFx0cHJvY2Vzcy5leGl0KDEpXG5cdH1cblxuXHRyZXR1cm4gY3A7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcm9zc1NwYXduT3RoZXIoYmluOiBzdHJpbmcsIGNtZF9saXN0OiBzdHJpbmdbXSwgYXJndilcbntcblx0Y29uc29sZURlYnVnLmRlYnVnKGJpbiwgY21kX2xpc3QpO1xuXG5cdGxldCBjcCA9IGNyb3NzU3Bhd24uc3luYygnbnBtJywgY21kX2xpc3QuZmlsdGVyKHYgPT4gdiAhPSBudWxsKSwge1xuXHRcdHN0ZGlvOiAnaW5oZXJpdCcsXG5cdFx0Y3dkOiBhcmd2LmN3ZCxcblx0fSk7XG5cblx0cmV0dXJuIF9jcm9zc1NwYXduT3RoZXIoY3ApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3Jvc3NTcGF3bk90aGVyQXN5bmMoYmluOiBzdHJpbmcsIGNtZF9saXN0OiBzdHJpbmdbXSwgYXJndilcbntcblxuXHRjb25zb2xlRGVidWcuZGVidWcoYmluLCBjbWRfbGlzdCk7XG5cblx0cmV0dXJuIGNyb3NzU3Bhd24uYXN5bmMoJ25wbScsIGNtZF9saXN0LmZpbHRlcih2ID0+IHYgIT0gbnVsbCksIHtcblx0XHRzdGRpbzogJ2luaGVyaXQnLFxuXHRcdGN3ZDogYXJndi5jd2QsXG5cdH0pXG5cdFx0LnRhcChfY3Jvc3NTcGF3bk90aGVyKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJvY2Vzc0FyZ3ZTbGljZShrZXlzX2lucHV0OiBzdHJpbmcgfCBzdHJpbmdbXSwgYXJndl9pbnB1dCA9IHByb2Nlc3MuYXJndiwgc3RhcnRpbmRleDogbnVtYmVyID0gMilcbntcblx0aWYgKHR5cGVvZiBrZXlzX2lucHV0ID09PSAnc3RyaW5nJylcblx0e1xuXHRcdGtleXNfaW5wdXQgPSBba2V5c19pbnB1dF07XG5cdH1cblxuXHRsZXQgYXJndl9iZWZvcmUgPSBhcmd2X2lucHV0LnNsaWNlKDAsIHN0YXJ0aW5kZXgpO1xuXHRsZXQgYXJndl9hZnRlciA9IGFyZ3ZfaW5wdXQuc2xpY2Uoc3RhcnRpbmRleCk7XG5cblx0bGV0IGlkeCA9IGtleXNfaW5wdXQucmVkdWNlKGZ1bmN0aW9uIChhLCBiKVxuXHR7XG5cdFx0bGV0IGkgPSBhcmd2X2FmdGVyLmluZGV4T2YoYik7XG5cblx0XHRpZiAoYSA9PT0gLTEpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIGk7XG5cdFx0fVxuXHRcdGVsc2UgaWYgKGkgIT09IC0xKVxuXHRcdHtcblx0XHRcdHJldHVybiBNYXRoLm1pbihpLCBhKVxuXHRcdH1cblxuXHRcdHJldHVybiBhXG5cdH0sIC0xKTtcblxuXG5cdGxldCBhcmd2ID0gKGlkeCA+IC0xKSA/IGFyZ3ZfYWZ0ZXIuc2xpY2UoaWR4ICsgMSkgOiBudWxsO1xuXHRsZXQga2V5ID0gKGlkeCA+IC0xKSA/IGFyZ3ZfYWZ0ZXJbaWR4XSA6IG51bGw7XG5cblx0bGV0IGlkeF9yZWJhc2UgPSAoaWR4ID4gLTEpID8gaWR4ICsgc3RhcnRpbmRleCA6IC0xO1xuXG5cdHJldHVybiB7XG5cdFx0aWR4X3JlYmFzZSxcblx0XHRpZHgsXG5cdFx0YXJndl9pbnB1dCxcblx0XHRhcmd2X2JlZm9yZSxcblx0XHRhcmd2X2FmdGVyLFxuXHRcdGFyZ3YsXG5cdFx0a2V5c19pbnB1dCxcblx0XHRrZXksXG5cdH07XG59XG4iXX0=