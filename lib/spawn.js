"use strict";
/**
 * Created by user on 2019/5/18.
 */
Object.defineProperty(exports, "__esModule", { value: true });
const crossSpawn = require("cross-spawn-extra");
const index_1 = require("./index");
function requireResolve(name) {
    try {
        let ret = require.resolve(name);
        if (ret) {
            return ret;
        }
    }
    catch (e) {
    }
    return null;
}
exports.requireResolve = requireResolve;
function checkModileExists(argv) {
    let ret = requireResolve(argv.requireName || argv.name);
    if (!ret) {
        index_1.console.magenta.log(`module '${argv.name}' not exists`);
        index_1.console.log(`please use follow cmd for install`);
        index_1.console.cyan.log(`\n\t${argv.installCmd || 'npm install -g'} ${argv.name}\n`);
        if (argv.msg) {
            index_1.console.log(`${argv.msg}\n`);
        }
        if (argv.processExit) {
            process.exit(argv.processExit | 0);
        }
        return null;
    }
    return ret;
}
exports.checkModileExists = checkModileExists;
function _crossSpawnOther(cp) {
    // @ts-ignore
    if (cp.error) {
        // @ts-ignore
        throw cp.error;
    }
    // @ts-ignore
    if (cp.signal) {
        // @ts-ignore
        index_1.consoleDebug.error(`cp.signal`, cp.signal);
        process.exit(1);
    }
    return cp;
}
exports._crossSpawnOther = _crossSpawnOther;
function crossSpawnOther(bin, cmd_list, argv, crossSpawnOptions) {
    //consoleDebug.debug(bin, cmd_list);
    let cp = crossSpawn.sync(bin, cmd_list.filter(v => v != null), {
        stdio: 'inherit',
        cwd: argv.cwd,
        ...crossSpawnOptions,
    });
    return _crossSpawnOther(cp);
}
exports.crossSpawnOther = crossSpawnOther;
function crossSpawnOtherAsync(bin, cmd_list, argv) {
    //consoleDebug.debug(bin, cmd_list);
    return crossSpawn.async(bin, cmd_list.filter(v => v != null), {
        stdio: 'inherit',
        cwd: argv.cwd,
    })
        .tap(_crossSpawnOther);
}
exports.crossSpawnOtherAsync = crossSpawnOtherAsync;
function processArgvSlice(keys_input, argv_input = process.argv, startindex = 2) {
    if (typeof keys_input === 'string') {
        keys_input = [keys_input];
    }
    let argv_before = argv_input.slice(0, startindex);
    let argv_after = argv_input.slice(startindex);
    let idx = keys_input.reduce(function (a, b) {
        let i = argv_after.indexOf(b);
        if (a === -1) {
            return i;
        }
        else if (i !== -1) {
            return Math.min(i, a);
        }
        return a;
    }, -1);
    let argv = (idx > -1) ? argv_after.slice(idx + 1) : null;
    let key = (idx > -1) ? argv_after[idx] : null;
    let idx_rebase = (idx > -1) ? idx + startindex : -1;
    return {
        idx_rebase,
        idx,
        argv_input,
        argv_before,
        argv_after,
        argv,
        keys_input,
        key,
    };
}
exports.processArgvSlice = processArgvSlice;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3Bhd24uanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJzcGF3bi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUE7O0dBRUc7O0FBRUgsZ0RBQWlEO0FBR2pELG1DQUFnRDtBQUtoRCxTQUFnQixjQUFjLENBQUMsSUFBWTtJQUUxQyxJQUNBO1FBQ0MsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUVoQyxJQUFJLEdBQUcsRUFDUDtZQUNDLE9BQU8sR0FBRyxDQUFBO1NBQ1Y7S0FDRDtJQUNELE9BQU8sQ0FBQyxFQUNSO0tBRUM7SUFFRCxPQUFPLElBQUksQ0FBQztBQUNiLENBQUM7QUFqQkQsd0NBaUJDO0FBRUQsU0FBZ0IsaUJBQWlCLENBQUMsSUFNakM7SUFFQSxJQUFJLEdBQUcsR0FBRyxjQUFjLENBQUMsSUFBSSxDQUFDLFdBQVcsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7SUFFeEQsSUFBSSxDQUFDLEdBQUcsRUFDUjtRQUNDLGVBQU8sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLFdBQVcsSUFBSSxDQUFDLElBQUksY0FBYyxDQUFDLENBQUM7UUFDeEQsZUFBTyxDQUFDLEdBQUcsQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO1FBQ2pELGVBQU8sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLE9BQU8sSUFBSSxDQUFDLFVBQVUsSUFBSSxnQkFBZ0IsSUFBSSxJQUFJLENBQUMsSUFBSSxJQUFJLENBQUMsQ0FBQztRQUU5RSxJQUFJLElBQUksQ0FBQyxHQUFHLEVBQ1o7WUFDQyxlQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLENBQUM7U0FDN0I7UUFFRCxJQUFJLElBQUksQ0FBQyxXQUFXLEVBQ3BCO1lBQ0MsT0FBTyxDQUFDLElBQUksQ0FBRSxJQUFJLENBQUMsV0FBc0IsR0FBRyxDQUFDLENBQUMsQ0FBQztTQUMvQztRQUVELE9BQU8sSUFBSSxD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LENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDO0lBRTlDLElBQUksVUFBVSxHQUFHLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsR0FBRyxVQUFVLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBRXBELE9BQU87UUFDTixVQUFVO1FBQ1YsR0FBRztRQUNILFVBQVU7UUFDVixXQUFXO1FBQ1gsVUFBVTtRQUNWLElBQUk7UUFDSixVQUFVO1FBQ1YsR0FBRztLQUNILENBQUM7QUFDSCxDQUFDO0FBMUNELDRDQTBDQyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ3JlYXRlZCBieSB1c2VyIG9uIDIwMTkvNS8xOC5cbiAqL1xuXG5pbXBvcnQgY3Jvc3NTcGF3biA9IHJlcXVpcmUoJ2Nyb3NzLXNwYXduLWV4dHJhJyk7XG5pbXBvcnQgKiBhcyB5YXJncyBmcm9tICd5YXJncyc7XG5pbXBvcnQgeyBJVW5wYWNrTXlZYXJnc0FyZ3YgfSBmcm9tICcuL2NsaSc7XG5pbXBvcnQgeyBjb25zb2xlRGVidWcsIGNvbnNvbGUgfSBmcm9tICcuL2luZGV4JztcbmltcG9ydCBCbHVlYmlyZCA9IHJlcXVpcmUoJ2JsdWViaXJkJyk7XG5pbXBvcnQgeyBBcmd1bWVudHMgfSBmcm9tICd5YXJncyc7XG5pbXBvcnQgeyBTcGF3blN5bmNPcHRpb25zIH0gZnJvbSAnY3Jvc3Mtc3Bhd24tZXh0cmEvdHlwZSc7XG5cbmV4cG9ydCBmdW5jdGlvbiByZXF1aXJlUmVzb2x2ZShuYW1lOiBzdHJpbmcpXG57XG5cdHRyeVxuXHR7XG5cdFx0bGV0IHJldCA9IHJlcXVpcmUucmVzb2x2ZShuYW1lKTtcblxuXHRcdGlmIChyZXQpXG5cdFx0e1xuXHRcdFx0cmV0dXJuIHJldFxuXHRcdH1cblx0fVxuXHRjYXRjaCAoZSlcblx0e1xuXG5cdH1cblxuXHRyZXR1cm4gbnVsbDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNoZWNrTW9kaWxlRXhpc3RzKGFyZ3Y6IHtcblx0bmFtZTogc3RyaW5nLFxuXHRtc2c/OiBzdHJpbmcsXG5cdHJlcXVpcmVOYW1lPzogc3RyaW5nLFxuXHRpbnN0YWxsQ21kPzogc3RyaW5nXG5cdHByb2Nlc3NFeGl0PzogYm9vbGVhbiB8IG51bWJlcixcbn0pXG57XG5cdGxldCByZXQgPSByZXF1aXJlUmVzb2x2ZShhcmd2LnJlcXVpcmVOYW1lIHx8IGFyZ3YubmFtZSk7XG5cblx0aWYgKCFyZXQpXG5cdHtcblx0XHRjb25zb2xlLm1hZ2VudGEubG9nKGBtb2R1bGUgJyR7YXJndi5uYW1lfScgbm90IGV4aXN0c2ApO1xuXHRcdGNvbnNvbGUubG9nKGBwbGVhc2UgdXNlIGZvbGxvdyBjbWQgZm9yIGluc3RhbGxgKTtcblx0XHRjb25zb2xlLmN5YW4ubG9nKGBcXG5cXHQke2FyZ3YuaW5zdGFsbENtZCB8fCAnbnBtIGluc3RhbGwgLWcnfSAke2FyZ3YubmFtZX1cXG5gKTtcblxuXHRcdGlmIChhcmd2Lm1zZylcblx0XHR7XG5cdFx0XHRjb25zb2xlLmxvZyhgJHthcmd2Lm1zZ31cXG5gKTtcblx0XHR9XG5cblx0XHRpZiAoYXJndi5wcm9jZXNzRXhpdClcblx0XHR7XG5cdFx0XHRwcm9jZXNzLmV4aXQoKGFyZ3YucHJvY2Vzc0V4aXQgYXMgbnVtYmVyKSB8IDApO1xuXHRcdH1cblxuXHRcdHJldHVybiBudWxsO1xuXHR9XG5cblx0cmV0dXJuIHJldDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIF9jcm9zc1NwYXduT3RoZXI8VD4oY3A6IFQpXG57XG5cdC8vIEB0cy1pZ25vcmVcblx0aWYgKGNwLmVycm9yKVxuXHR7XG5cdFx0Ly8gQHRzLWlnbm9yZVxuXHRcdHRocm93IGNwLmVycm9yXG5cdH1cblxuXHQvLyBAdHMtaWdub3JlXG5cdGlmIChjcC5zaWduYWwpXG5cdHtcblx0XHQvLyBAdHMtaWdub3JlXG5cdFx0Y29uc29sZURlYnVnLmVycm9yKGBjcC5zaWduYWxgLCBjcC5zaWduYWwpO1xuXHRcdHByb2Nlc3MuZXhpdCgxKVxuXHR9XG5cblx0cmV0dXJuIGNwO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3Jvc3NTcGF3bk90aGVyKGJpbjogc3RyaW5nLFxuXHRjbWRfbGlzdDogc3RyaW5nW10sXG5cdGFyZ3Y6IFBhcnRpYWw8QXJndW1lbnRzPiAmIHtcblx0XHRjd2Q6IHN0cmluZ1xuXHR9LFxuXHRjcm9zc1NwYXduT3B0aW9ucz86IFNwYXduU3luY09wdGlvbnNcbilcbntcblx0Ly9jb25zb2xlRGVidWcuZGVidWcoYmluLCBjbWRfbGlzdCk7XG5cblx0bGV0IGNwID0gY3Jvc3NTcGF3bi5zeW5jKGJpbiwgY21kX2xpc3QuZmlsdGVyKHYgPT4gdiAhPSBudWxsKSwge1xuXHRcdHN0ZGlvOiAnaW5oZXJpdCcsXG5cdFx0Y3dkOiBhcmd2LmN3ZCxcblx0XHQuLi5jcm9zc1NwYXduT3B0aW9ucyxcblx0fSk7XG5cblx0cmV0dXJuIF9jcm9zc1NwYXduT3RoZXIoY3ApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3Jvc3NTcGF3bk90aGVyQXN5bmMoYmluOiBzdHJpbmcsIGNtZF9saXN0OiBzdHJpbmdbXSwgYXJndilcbntcblx0Ly9jb25zb2xlRGVidWcuZGVidWcoYmluLCBjbWRfbGlzdCk7XG5cblx0cmV0dXJuIGNyb3NzU3Bhd24uYXN5bmMoYmluLCBjbWRfbGlzdC5maWx0ZXIodiA9PiB2ICE9IG51bGwpLCB7XG5cdFx0c3RkaW86ICdpbmhlcml0Jyxcblx0XHRjd2Q6IGFyZ3YuY3dkLFxuXHR9KVxuXHRcdC50YXAoX2Nyb3NzU3Bhd25PdGhlcilcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHByb2Nlc3NBcmd2U2xpY2Uoa2V5c19pbnB1dDogc3RyaW5nIHwgc3RyaW5nW10sIGFyZ3ZfaW5wdXQgPSBwcm9jZXNzLmFyZ3YsIHN0YXJ0aW5kZXg6IG51bWJlciA9IDIpXG57XG5cdGlmICh0eXBlb2Yga2V5c19pbnB1dCA9PT0gJ3N0cmluZycpXG5cdHtcblx0XHRrZXlzX2lucHV0ID0gW2tleXNfaW5wdXRdO1xuXHR9XG5cblx0bGV0IGFyZ3ZfYmVmb3JlID0gYXJndl9pbnB1dC5zbGljZSgwLCBzdGFydGluZGV4KTtcblx0bGV0IGFyZ3ZfYWZ0ZXIgPSBhcmd2X2lucHV0LnNsaWNlKHN0YXJ0aW5kZXgpO1xuXG5cdGxldCBpZHggPSBrZXlzX2lucHV0LnJlZHVjZShmdW5jdGlvbiAoYSwgYilcblx0e1xuXHRcdGxldCBpID0gYXJndl9hZnRlci5pbmRleE9mKGIpO1xuXG5cdFx0aWYgKGEgPT09IC0xKVxuXHRcdHtcblx0XHRcdHJldHVybiBpO1xuXHRcdH1cblx0XHRlbHNlIGlmIChpICE9PSAtMSlcblx0XHR7XG5cdFx0XHRyZXR1cm4gTWF0aC5taW4oaSwgYSlcblx0XHR9XG5cblx0XHRyZXR1cm4gYVxuXHR9LCAtMSk7XG5cblxuXHRsZXQgYXJndiA9IChpZHggPiAtMSkgPyBhcmd2X2FmdGVyLnNsaWNlKGlkeCArIDEpIDogbnVsbDtcblx0bGV0IGtleSA9IChpZHggPiAtMSkgPyBhcmd2X2FmdGVyW2lkeF0gOiBudWxsO1xuXG5cdGxldCBpZHhfcmViYXNlID0gKGlkeCA+IC0xKSA/IGlkeCArIHN0YXJ0aW5kZXggOiAtMTtcblxuXHRyZXR1cm4ge1xuXHRcdGlkeF9yZWJhc2UsXG5cdFx0aWR4LFxuXHRcdGFyZ3ZfaW5wdXQsXG5cdFx0YXJndl9iZWZvcmUsXG5cdFx0YXJndl9hZnRlcixcblx0XHRhcmd2LFxuXHRcdGtleXNfaW5wdXQsXG5cdFx0a2V5LFxuXHR9O1xufVxuIl19