"use strict";
/**
 * 因為 ./cli.ts 似乎寫出BUG 所以只好打掉重練一個
 *
 * 但是依然BUG...
 * 放棄修正
 */
Object.defineProperty(exports, "__esModule", { value: true });
exports.lazySpawnArgvSlice = exports.commandDirJoin = exports.commandDirStrip = exports.basenameStrip = exports._dummyHandler = exports._dummyBuilder = exports.createCommandModuleExports = void 0;
const path = require("upath2");
const spawn_1 = require("./spawn");
function createCommandModuleExports(module) {
    // @ts-ignore
    if (module.builder == null && module.handler == null) {
        // @ts-ignore
        throw new TypeError(`'builder' or 'handler' must exists, but got\nbuilder: ${module.builder}\nhandler: ${module.handler}`);
    }
    // @ts-ignore
    let { builder = _dummyBuilder, handler = _dummyHandler } = module;
    return {
        ...module,
        builder,
        handler,
    };
}
exports.createCommandModuleExports = createCommandModuleExports;
function _dummyBuilder(yarg) {
    return yarg;
}
exports._dummyBuilder = _dummyBuilder;
function _dummyHandler(args) {
    return args;
}
exports._dummyHandler = _dummyHandler;
function basenameStrip(name) {
    return path.basename(name, path.extname(name));
}
exports.basenameStrip = basenameStrip;
function commandDirStrip(name, suffix = '_cmds') {
    return basenameStrip(name) + suffix;
}
exports.commandDirStrip = commandDirStrip;
function commandDirJoin(root, name, suffix = '_cmds') {
    return path.join(root, commandDirStrip(name));
}
exports.commandDirJoin = commandDirJoin;
function lazySpawnArgvSlice(options) {
    let cmd_list = spawn_1.processArgvSlice(options.command).argv;
    return spawn_1.crossSpawnOther(options.bin, [
        ...(Array.isArray(options.cmd) ? options.cmd : [options.cmd]),
        ...cmd_list,
    ], options.argv, options.crossSpawnOptions);
}
exports.lazySpawnArgvSlice = lazySpawnArgvSlice;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY21kX2Rpci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNtZF9kaXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBOzs7OztHQUtHOzs7QUFLSCwrQkFBZ0M7QUFDaEMsbUNBQStFO0FBcUMvRSxTQUFnQiwwQkFBMEIsQ0FBcUgsTUFBbUM7SUFFak0sYUFBYTtJQUNiLElBQUksTUFBTSxDQUFDLE9BQU8sSUFBSSxJQUFJLElBQUksTUFBTSxDQUFDLE9BQU8sSUFBSSxJQUFJLEVBQ3BEO1FBQ0MsYUFBYTtRQUNiLE1BQU0sSUFBSSxTQUFTLENBQUMseURBQXlELE1BQU0sQ0FBQyxPQUFPLGNBQWMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLENBQUE7S0FDMUg7SUFFRCxhQUFhO0lBQ2IsSUFBSSxFQUFFLE9BQU8sR0FBRyxhQUFhLEVBQUUsT0FBTyxHQUFHLGFBQWEsRUFBRSxHQUFHLE1BQU0sQ0FBQztJQUVsRSxPQUFPO1FBQ04sR0FBRyxNQUFNO1FBQ1QsT0FBTztRQUNQLE9BQU87S0FDZ0IsQ0FBQTtBQUN6QixDQUFDO0FBakJELGdFQWlCQztBQUVELFNBQWdCLGFBQWEsQ0FBZSxJQUFhO0lBRXhELE9BQU8sSUFBSSxDQUFBO0FBQ1osQ0FBQztBQUhELHNDQUdDO0FBRUQsU0FBZ0IsYUFBYSxDQUFlLElBQWtCO0lBRTdELE9BQU8sSUFBSSxDQUFBO0FBQ1osQ0FBQztBQUhELHNDQUdDO0FBRUQsU0FBZ0IsYUFBYSxDQUFDLElBQVk7SUFFekMsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUE7QUFDL0MsQ0FBQztBQUhELHNDQUdDO0FBRUQsU0FBZ0IsZUFBZSxDQUFDLElBQVksRUFBRSxNQUFNLEdBQUcsT0FBTztJQUU3RCxPQUFPLGFBQWEsQ0FBQyxJQUFJLENBQUMsR0FBRyxNQUFNLENBQUE7QUFDcEMsQ0FBQztBQUhELDBDQUdDO0FBRUQsU0FBZ0IsY0FBYyxDQUFDLElBQVksRUFBRSxJQUFZLEVBQUUsTUFBTSxHQUFHLE9BQU87SUFFMUUsT0FBTyxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQTtBQUM5QyxDQUFDO0FBSEQsd0NBR0M7QUFFRCxTQUFnQixrQkFBa0IsQ0FBQyxPQVFsQztJQUVBLElBQUksUUFBUSxHQUFHLHdCQUFnQixDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQyxJQUFJLENBQUM7SUFFdEQsT0FBTyx1QkFBZSxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUU7UUFFbkMsR0FBRyxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUU3RCxHQUFHLFFBQVE7S0FDWCxFQUFFLE9BQU8sQ0FBQyxJQUFJLEVBQUUsT0FBTyxDQUFDLGlCQUFpQixDQUFDLENBQUM7QUFDN0MsQ0FBQztBQWxCRCxnREFrQkMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIOWboOeCuiAuL2NsaS50cyDkvLzkuY7lr6vlh7pCVUcg5omA5Lul5Y+q5aW95omT5o6J6YeN57e05LiA5YCLXG4gKlxuICog5L2G5piv5L6d54S2QlVHLi4uXG4gKiDmlL7mo4Tkv67mraNcbiAqL1xuXG5pbXBvcnQgeWFyZ3MgPSByZXF1aXJlKCd5YXJncycpO1xuaW1wb3J0IHsgQ29tbWFuZE1vZHVsZSwgQXJndW1lbnRzLCBBcmd2LCBDb21tYW5kQnVpbGRlciwgT3B0aW9ucyB9IGZyb20gJ3lhcmdzJztcbmltcG9ydCB7IElUU092ZXJ3cml0ZSB9IGZyb20gJ3RzLXR5cGUnO1xuaW1wb3J0IHBhdGggPSByZXF1aXJlKCd1cGF0aDInKTtcbmltcG9ydCB7IGNoZWNrTW9kaWxlRXhpc3RzLCBjcm9zc1NwYXduT3RoZXIsIHByb2Nlc3NBcmd2U2xpY2UgfSBmcm9tICcuL3NwYXduJztcbmltcG9ydCB7IFNwYXduU3luY09wdGlvbnMgfSBmcm9tICdjcm9zcy1zcGF3bi1leHRyYS90eXBlJztcblxuZXhwb3J0IGludGVyZmFjZSBJVW5wYWNrTXlZYXJnc0FyZ3Zcbntcblx0Y3dkOiBzdHJpbmc7XG5cdHNraXBDaGVja1dvcmtzcGFjZT86IGJvb2xlYW47XG5cdHl0RGVidWdNb2RlPzogYm9vbGVhbjtcbn1cblxuZXhwb3J0IHR5cGUgSVVucGFja015WWFyZ3NBcmd2UGFydGlhbCA9IFBhcnRpYWw8SVVucGFja015WWFyZ3NBcmd2PjtcblxuZXhwb3J0IHR5cGUgSVVucGFja1lhcmdzQXJndjxUIGV4dGVuZHMgQXJndiwgRCA9IGFueT4gPSBUIGV4dGVuZHMgQXJndjxpbmZlciBVPiA/IFUgOiBEO1xuXG5leHBvcnQgdHlwZSBJQ29tbWFuZEJ1aWxkZXJGbjxUID0gb2JqZWN0LCBVID0gb2JqZWN0PiA9IChhcmdzOiBBcmd2PFQ+KSA9PiBBcmd2PFU+O1xuXG5leHBvcnQgaW50ZXJmYWNlIElDb21tYW5kQnVpbGRlck9iamVjdDxUID0gb2JqZWN0LCBVID0gb2JqZWN0Plxue1xuXHRba2V5OiBzdHJpbmddOiBPcHRpb25zXG59XG5cbmV4cG9ydCB0eXBlIElDb21tYW5kTW9kdWxlT21pdDxUIGV4dGVuZHMgSVVucGFja015WWFyZ3NBcmd2UGFydGlhbCA9IElVbnBhY2tNeVlhcmdzQXJndiwgVSBleHRlbmRzIHt9ID0gSVVucGFja015WWFyZ3NBcmd2UGFydGlhbD4gPSBPbWl0PENvbW1hbmRNb2R1bGUsICdoYW5kbGVyJyB8ICdidWlsZGVyJz47XG5cbmV4cG9ydCB0eXBlIElDb21tYW5kTW9kdWxlRXhwb3J0czxUIGV4dGVuZHMgSVVucGFja015WWFyZ3NBcmd2UGFydGlhbCA9IElVbnBhY2tNeVlhcmdzQXJndiwgVSBleHRlbmRzIElVbnBhY2tNeVlhcmdzQXJndlBhcnRpYWwgPSBJVW5wYWNrTXlZYXJnc0FyZ3Y+ID1cblx0SUNvbW1hbmRNb2R1bGVPbWl0XG5cdCYgKHtcblx0YnVpbGRlcihhcmdzOiBBcmd2PFQ+KTogQXJndjxVPjtcblx0aGFuZGxlcjogKGFyZ3M6IEFyZ3VtZW50czxVPikgPT4gYW55O1xufSB8IHtcblx0YnVpbGRlcjogSUNvbW1hbmRCdWlsZGVyT2JqZWN0O1xuXHRoYW5kbGVyOiAoYXJnczogQXJndW1lbnRzPFU+KSA9PiBhbnk7XG59IHwge1xuXHRoYW5kbGVyOiAoYXJnczogQXJndW1lbnRzPFQ+KSA9PiBhbnk7XG59IHwge1xuXHRidWlsZGVyKGFyZ3M6IEFyZ3Y8VD4pOiBBcmd2PFU+O1xufSk7XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVDb21tYW5kTW9kdWxlRXhwb3J0czxUIGV4dGVuZHMgSVVucGFja015WWFyZ3NBcmd2UGFydGlhbCA9IElVbnBhY2tNeVlhcmdzQXJndiwgVSBleHRlbmRzIElVbnBhY2tNeVlhcmdzQXJndlBhcnRpYWwgPSBJVW5wYWNrTXlZYXJnc0FyZ3Y+KG1vZHVsZTogSUNvbW1hbmRNb2R1bGVFeHBvcnRzPFQsIFU+KTogQ29tbWFuZE1vZHVsZTxULCBVPlxue1xuXHQvLyBAdHMtaWdub3JlXG5cdGlmIChtb2R1bGUuYnVpbGRlciA9PSBudWxsICYmIG1vZHVsZS5oYW5kbGVyID09IG51bGwpXG5cdHtcblx0XHQvLyBAdHMtaWdub3JlXG5cdFx0dGhyb3cgbmV3IFR5cGVFcnJvcihgJ2J1aWxkZXInIG9yICdoYW5kbGVyJyBtdXN0IGV4aXN0cywgYnV0IGdvdFxcbmJ1aWxkZXI6ICR7bW9kdWxlLmJ1aWxkZXJ9XFxuaGFuZGxlcjogJHttb2R1bGUuaGFuZGxlcn1gKVxuXHR9XG5cblx0Ly8gQHRzLWlnbm9yZVxuXHRsZXQgeyBidWlsZGVyID0gX2R1bW15QnVpbGRlciwgaGFuZGxlciA9IF9kdW1teUhhbmRsZXIgfSA9IG1vZHVsZTtcblxuXHRyZXR1cm4ge1xuXHRcdC4uLm1vZHVsZSxcblx0XHRidWlsZGVyLFxuXHRcdGhhbmRsZXIsXG5cdH0gYXMgQ29tbWFuZE1vZHVsZTxULCBVPlxufVxuXG5leHBvcnQgZnVuY3Rpb24gX2R1bW15QnVpbGRlcjxUIGV4dGVuZHMge30+KHlhcmc6IEFyZ3Y8VD4pXG57XG5cdHJldHVybiB5YXJnXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBfZHVtbXlIYW5kbGVyPFQgZXh0ZW5kcyB7fT4oYXJnczogQXJndW1lbnRzPFQ+KTogYW55XG57XG5cdHJldHVybiBhcmdzXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBiYXNlbmFtZVN0cmlwKG5hbWU6IHN0cmluZylcbntcblx0cmV0dXJuIHBhdGguYmFzZW5hbWUobmFtZSwgcGF0aC5leHRuYW1lKG5hbWUpKVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY29tbWFuZERpclN0cmlwKG5hbWU6IHN0cmluZywgc3VmZml4ID0gJ19jbWRzJylcbntcblx0cmV0dXJuIGJhc2VuYW1lU3RyaXAobmFtZSkgKyBzdWZmaXhcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbW1hbmREaXJKb2luKHJvb3Q6IHN0cmluZywgbmFtZTogc3RyaW5nLCBzdWZmaXggPSAnX2NtZHMnKVxue1xuXHRyZXR1cm4gcGF0aC5qb2luKHJvb3QsIGNvbW1hbmREaXJTdHJpcChuYW1lKSlcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxhenlTcGF3bkFyZ3ZTbGljZShvcHRpb25zOiB7XG5cdGJpbjogc3RyaW5nLFxuXHRjb21tYW5kOiBzdHJpbmcgfCBzdHJpbmdbXSxcblx0Y21kPzogc3RyaW5nIHwgc3RyaW5nW10sXG5cdGFyZ3Y6IHtcblx0XHRjd2Q6IHN0cmluZ1xuXHR9LFxuXHRjcm9zc1NwYXduT3B0aW9ucz86IFNwYXduU3luY09wdGlvbnNcbn0pXG57XG5cdGxldCBjbWRfbGlzdCA9IHByb2Nlc3NBcmd2U2xpY2Uob3B0aW9ucy5jb21tYW5kKS5hcmd2O1xuXG5cdHJldHVybiBjcm9zc1NwYXduT3RoZXIob3B0aW9ucy5iaW4sIFtcblxuXHRcdC4uLihBcnJheS5pc0FycmF5KG9wdGlvbnMuY21kKSA/IG9wdGlvbnMuY21kIDogW29wdGlvbnMuY21kXSksXG5cblx0XHQuLi5jbWRfbGlzdCxcblx0XSwgb3B0aW9ucy5hcmd2LCBvcHRpb25zLmNyb3NzU3Bhd25PcHRpb25zKTtcbn1cbiJdfQ==